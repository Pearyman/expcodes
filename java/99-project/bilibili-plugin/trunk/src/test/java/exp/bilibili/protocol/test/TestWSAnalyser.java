package exp.bilibili.protocol.test;

import exp.libs.utils.num.BODHUtils;
import exp.libs.utils.other.StrUtils;

public class TestWSAnalyser {

	public static void main(String[] args) {
		String hex = "0000022E0010000000000005000000007B22636D64223A225359535F47494654222C226D7367223A225C75373332625C75366361325C75333065625C75333065613A3F205C75353732385C75373666345C75363461645C7539356634203A3F333638353539323A3F205C75346637665C75373532385C7534653836203230205C75353030645C75383238325C75353934665C75393863655C75363662345C75666630635C75353932375C75356262365C75356665625C75353362625C75386464665C75393863655C75393838365C75353364365C75353935365C75353262315C75353432375C7566663031222C2274697073223A225C75333031305C75373332625C75366361325C75333065625C75333065615C75333031315C75353732385C75373666345C75363461645C75393566345C7533303130333638353539325C75333031315C75346637665C75373532385C7534653836203230205C75353030645C75383238325C75353934665C75393863655C75363662345C75666630635C75353932375C75356262365C75356665625C75353362625C75386464665C75393863655C75393838365C75353364365C75353935365C75353262315C75353432375C7566663031222C22676966744964223A33392C226D736754697073223A312C2275726C223A22687474703A5C2F5C2F6C6976652E62696C6962696C692E636F6D5C2F33363835353932222C22726F6F6D6964223A333638353539322C22726E64223A313532343731323230347D";
		alalyseMsg(hex);
	}
	
	private static void alalyseMsg(String hexMsg) {
		byte[] bytes = BODHUtils.toBytes(hexMsg);
		String msg = new String(bytes);
		System.out.println(StrUtils.view(msg));
		System.out.println("====");
		
		int len = 0;
		do {
			len = getLen(hexMsg);
			if(len <= 32) {
				break;
			}
			String subHexMsg = hexMsg.substring(32, len);
			msg = new String(BODHUtils.toBytes(subHexMsg));
			System.out.println(StrUtils.view(msg));
			
			
			hexMsg = hexMsg.substring(len);
		} while(StrUtils.isNotEmpty(hexMsg));
	}
	
	private static int getLen(String hexMsg) {
		String hexLen = hexMsg.substring(0, 8);	// 消息的前8位是本条消息长度
		long len = BODHUtils.hexToDec(hexLen);
		return (int) (len * 2);
	}
	
}
